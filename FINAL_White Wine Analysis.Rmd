---
output:
  html_document: default
  pdf_document: default
---
Vino Analysis by Lorenz
========================================================

### Intro

Vino is everywhere! Especially white wine is the go the beverage during the summer as it is served best ice cold.
And let's face it: it is extremely hard to determine the quality of a wine, and most people are not able to do it (myself included)!

> **What makes a quality vino?**

### About the Data

The dataset contains data from 4898 variants of the Portuguese "Vinho Verde" (white wine).
Overall, there are 12 variables in the dataset.
The data is taken from chemical analysis (11 variables) and 1 subjective evaluation by wine experts for the input variable 'quality'.
'quality' represents the median of at least 3 evaluations made by wine experts. Each expert graded the wine quality 
between 0 (very bad) and 10 (very excellent).

Overview of variables and description of their meaning.

Variable                              | Descripton
------------------------------------- | ----------------------------------------
1. fixed acidity (g / dm^3 = liter(l))| tartaric acid  
2. volatile acidity (g / l)           | high level can lead to vinegar taste 
3. citric acid (g / l)                | small quantities, can add freshness, flavor to wines
4. residual sugar (g / l)             | sugar remaining after fermentation stops. Itâ€™s rare to find wines with less than 1 g / l and wines with more than 45 g / l are considered sweet
5. chlorides (sodium chloride - g / l)| amount of salt
6. free sulfur dioxide (mg / l)       | prevents microbial growth and the oxidation of wine
7. total sulfur dioxide (mg / l)      | amount of free and bound forms of S02. In low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine
8. density (g / cm^3)                 | density of wine is close to that of water depending on the percent alcohol and sugar content
9. pH                                 | scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale
10. sulphates (g / l)                 | a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant
11. alcohol (percentage by volume)    | percentage of alcohol
12. quality                           | score between 0 and 10

Variables can be grouped in 3 categories:

##### Category 1:
Acidity (1, 2, 3, 9)

##### Category 2:
Sugar & Salts (4, 5, 6, 7, 10)

##### Category 3:
Misc - density (8), alcohol percentage (11) and quality (12)

> **Predict Vino Quality**

The variable of interest (dependent variable) is 'quality', since this is the ultimate measure of wine. In the end, I would like to know which constitutes to look for when buying the next vino. Therefore, I will investigate what variables might influence the quality. Finally, I will build a model that can predict wine quality based on its substances.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Load the packages
# the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output.

library(ggplot2)
library(grid)
library(gridExtra)
library(GGally)
library(corrplot)
library(MASS)
library(scales)
library(memisc)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
wine <- read.csv('wineQualityWhites.csv')
str(wine)
```
All independent variables are numerics. 'quality' is an integer. 
First, I removed X, since it is just a counter variable.

```{r}
# Drop the X column, since it is just a counter
wine <- subset(wine, select = -c(X))
```

Then, I factored 'quality' and named the new variable factor.quality since this is a categorical variable.

```{r}
# factor quality
wine$quality.factor <- factor(wine$quality)
str(wine)
```

To get a first impression of the data, I run the summary statistic.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
summary(wine)
```

Most of the variables, except residual sugar, have means and medians pretty close to each other. Additionally, their max values are far from the third quartile (except pH). The distributions of these variables might be normal with outliers on the right tail.

The average alcohol percantage is 10.40% with a mininum of 8% and a maximum of 14.20%. The average sugar amount is 6.391 g/ l with a minimum of 0.60 and maximum of 65.80 g/ l. Density varies between 0.9871 and 1.0390 g / cm^3.

Surprisingly, none of the wines received a perfect quality score of 10, since the highest level for quality observed in the data is 9.
At the same time, none of the wines received a 'very poor' quality score of 0 either, since the lowest level observed is 3. It is also interesting to observe that there are very few samples for quality level 3 (only 20) or quality level 9 (only 5). This paucity of data at very low and very high quality scores might make it difficult to draw any statistically significant conclusions about the extremes of the quality scale.


### Univariate Plots & Analysis

To get a better idea of the distribution of the variables, I created the following histograms for all 3 groups of variables.

> **Histograms: Acidity**

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Histograms for Acidity
p1 <- ggplot(aes(x = fixed.acidity), data = wine) +
  geom_histogram(bins = 50, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(fixed.acidity)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$fixed.acidity, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$fixed.acidity, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(4, quantile(wine$fixed.acidity, 0.99))
  
p2 <- ggplot(aes(x = volatile.acidity), data = wine) +
  geom_histogram(bins = 50, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(volatile.acidity)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$volatile.acidity, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$volatile.acidity, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0.1, quantile(wine$volatile.acidity, 0.99))

p3 <- ggplot(aes(x = citric.acid), data = wine) +
  geom_histogram(bins = 40, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(citric.acid)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$citric.acid, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$citric.acid, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0, quantile(wine$citric.acid, 0.99))
  
p4 <- ggplot(aes(x = pH), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(pH)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$pH, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$pH, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(2.7, quantile(wine$pH, 0.99))

grid.arrange(p1, p2, p3, p4, ncol = 2)
```


All variables for acidity look reasonably normally distributed. For all variables, there is some positive skewing.

To get a better feeling for the distribution of the bulk of the data, I cut off the upper 1% quantile of the data and choose a bette fitting starting x-value. Additionally, I adjusted the bin sizes and included the mean in the each graph.

All variables appear to be approximately normally distributed, except volatile.acidity which remains slightly right-skewed. There is one interesting 'spike' in the citric acid profile, near a value of 0.5. There could be something about the wine production process that generates an unusual citric acid profile.

> **Histograms: Sugar & Salts**

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Histograms for Sugar & Salts
p5 <- ggplot(aes(x = residual.sugar), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(residual.sugar)), 
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$residual.sugar, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$residual.sugar, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0, quantile(wine$residual.sugar, 0.99)) +
  scale_x_log10()
  
p6 <- ggplot(aes(x = chlorides), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(chlorides)), 
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$chlorides, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$chlorides, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0.015, quantile(wine$chlorides, 0.99)) +
  scale_x_log10()

p7 <- ggplot(aes(x = free.sulfur.dioxide), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(free.sulfur.dioxide)), 
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$free.sulfur.dioxide, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$free.sulfur.dioxide, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0, quantile(wine$free.sulfur.dioxide, 0.99))
  
p8 <- ggplot(aes(x = total.sulfur.dioxide), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(total.sulfur.dioxide)), 
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$total.sulfur.dioxide, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$total.sulfur.dioxide, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0, quantile(wine$total.sulfur.dioxide, 0.99))

p9 <- ggplot(aes(x = sulphates), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "gray") +
  geom_vline(aes(xintercept = mean(sulphates)), 
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$sulphates, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$sulphates, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0.22, quantile(wine$sulphates, 0.99))

grid.arrange(p5, p6, p7, p8, p9, ncol = 2)
```

All histograms for sugar & salts look again reasonably normally distributed. For all variables, there is some positive skewing.

Again, I cut off the upper 1% quantile of the data, adjusted the bin size and choose a log scale for residual sugar and chlorides.

It appears that all variables are normally distributed, with the exception of residual sugar.
Residual sugar's distribution is positively skewed and looks even bimodally distributed.

> **Histograms: Density, Alcohol, Quality**

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# All in one acid shit
p10 <- ggplot(aes(x = density), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(density)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$density, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$density, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(0.985, 1.005)
  
p11 <- ggplot(aes(x = alcohol), data = wine) +
  geom_histogram(bins = 30, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(alcohol)),
            linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$alcohol, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$alcohol, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue") +
  xlim(8, quantile(wine$alcohol, 0.99))

p12 <- ggplot(aes(x = quality.factor), data = wine) +
  geom_bar(color = "black", fill = "grey")

p13 <- ggplot(aes(x = quality), data = wine) +
  geom_bar(bins = 1, color = "black", fill = "grey") +
  geom_vline(aes(xintercept = mean(quality)),
             linetype = 2, size = 0.8, color = "cyan1") +
  geom_vline(aes(xintercept = quantile(wine$quality, 0.25)),
            linetype = 3, size = 0.8, color = "darkblue") +
  geom_vline(aes(xintercept = quantile(wine$quality, 0.75)),
            linetype = 3, size = 0.8, color = "darkblue")

grid.arrange(p10, p11, p12, p13, ncol = 2)
```

After, cutting off the upper 1% quantile of the data and adjusting the bin size, density and alcohol appear to be approximately normally distributed. Both variables are positively skewed, with alcohol being more positively skewed.

Regarding quality categories, most of the wine in the dataset has a quality ranking of 6 followed by 5 and 7.

### Bivariate Plots Section & Analysis

> **Data Relationships**

I will kickoff my bivariate analysis with boxplots.
Therefore, I created boxplot visualizations for the 11 variables against the dependent variable quality.factor to get a first idea on possible relationships.

I started to look at boxplots for acidity followed by sugar & salts and density plus alcohol percentage.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# Boxplots Acidity
p18 <- ggplot(aes(x= quality.factor, y = fixed.acidity, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(4, quantile(wine$fixed.acidity, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")
  
p19 <- ggplot(aes(x= quality.factor, y = volatile.acidity, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.1, quantile(wine$volatile.acidity, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

p20 <- ggplot(aes(x= quality.factor, y = citric.acid, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0, quantile(wine$citric.acid, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")
  
p21 <- ggplot(aes(x= quality.factor, y = pH, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(2.7, quantile(wine$pH, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p18, p19, p20, p21, ncol = 3)
```

Looking at acidity variables against quality, there are no clear/ sticking out correlations.
It looks like wines within the quality category 9 have a higher citric acid amount. However, the amount of observations within quality category 9 is really small (only 5 wines).


```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#Boxplots Sugar & Salts
p13 <- ggplot(aes(x= quality.factor, y = residual.sugar, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0, quantile(wine$residual.sugar, 0.99)) +
  scale_y_log10()+
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  scale_fill_brewer(palette="Blues") +
  theme(legend.position="none")
  
p14 <- ggplot(aes(x= quality.factor, y = chlorides, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.015, quantile(wine$chlorides, 0.99)) +
  scale_y_log10() +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

p15 <- ggplot(aes(x= quality.factor, y = free.sulfur.dioxide, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0, quantile(wine$free.sulfur.dioxide, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")
  
p16 <- ggplot(aes(x= quality.factor, y = total.sulfur.dioxide, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0, quantile(wine$total.sulfur.dioxide, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

p17 <- ggplot(aes(x= quality.factor, y = sulphates, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.22, quantile(wine$sulphates, 0.99)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p13, p14, p15, p16, p17, ncol = 3)

```

For sugar & salts the boxplots illustrate similar findings. Again, no clear trends when measuring sugar & salts against quality categories.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#rest
p18 <- ggplot(aes(x= quality.factor, y = density, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.985, 1.005) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")
  
p19 <- ggplot(aes(x= quality.factor, y = alcohol, fill = quality.factor), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(8, quantile(wine$alcohol, 0.99)) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="none") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p18, p19, ncol = 2)
```

Now turning to density and alcohol percentage, the data writes a different story.
It seems that with the increase of quality density is decreasing. On the other hand, for higher quality categories, the alcohol percentage seems to be rising as well. Does more alcohol make more quality vino?

Trying to find out more about this trend, I will create a new categorical variable (category) to group the existing 9 quality categories in the good old "high", "medium" and "low" levels. "Low" consists of qualtiy scores (3, 4, 5), "medium" of (6) and "high" of (7, 8, 9). I chose this grouping to get a more evenly distributed and sufficiently big number of wines in each category to analyse this trend in more detail.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# grouping function
categorize <- function(x) {
  if (x < 6){
    'low'
  }
  else if (x < 7){
    'medium'
  }
  else 'high'
}

# apply function

wine$category <- ordered(sapply(wine$quality, categorize),
                         levels=c('low', 'medium','high'))

summary(wine$category)
```

Now I will apply the same visualization but using the new variable category.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# boxplot category
p20 <- ggplot(aes(x= category, y = density, fill = category), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.985, 1.005) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")
  
p21 <- ggplot(aes(x= category, y = alcohol, fill = category), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(8, quantile(wine$alcohol, 0.99)) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p20, p21, ncol = 2)
```

The new boxplots visualize even better, the negative correlation between density and quality and the positive correlation between alcohol and quality. 

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# freq poly
p22 <- ggplot(aes(x = alcohol, fill = category), data = wine) +
  geom_area(stat ="bin", alpha = 0.6, color = "black") +
  theme_classic() +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")

p23 <- ggplot(aes(x = density, fill = category), data = wine) +
  geom_area(stat ="bin", alpha = 0.6, color = "black") +
  xlim(0.985, 1.005) +
  theme_classic() +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p22, p23, ncol = 2)
```

The areaplots (frequency polygons) also support the above observed trend.
However, it looks like we have a lot of wines with an alcohol percentage of approx. 9%, 11% and 12.5% across all quality categories since we see peaks at all those alcohol levels. This could be due to a specific type of wine (the same production process).
We can observe similar peaks when looking at density. 

Digging deeper into relationships of all variables, it is always useful to look at correlation coefficients.

In the below figure, correlations with p-value > 0.05 are considered as insignificant.
In this case the correlation coefficient values not colored (are neglected due to low statistical significance/ interdependencies with other variables).

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
wine_corr <- cor(subset(wine, select = -c(quality.factor, category)))
# build the matrix for corrplot
cor.mtest <- function(mat, ...) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat<- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
        for (j in (i + 1):n) {
            tmp <- cor.test(mat[, i], mat[, j], ...)
            p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
        }
    }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}
# matrix of the p-value of the correlation
p.mat <- cor.mtest(wine_corr)
head(p.mat[, 1:5])
```


```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
col <- colorRampPalette(c("cyan1", "cyan3", "deepskyblue1", "cornflowerblue", "darkblue"))
corrplot(wine_corr, method="color", col=col(100),  
         type="lower", order="hclust", 
         addCoef.col = "white", # Add coefficient of correlation
         tl.col="black", tl.srt=0.2,
         # significance
         p.mat = p.mat, sig.level = 0.05, insig = "blank", 
         diag=FALSE)
```

This chart displays the highest correlation coefficient (0.84) between density and sugar. This means that these variables have a very strong positive linear relationship.
Additionally, we see a strong negative correlation between density and alcohol (-0.78).
There is also a moderatly positive relationship between alcohol and quality (highest coefficient with 0.44), which seems to add up with our observations from earlier.
I would like to visualize these relationships in the following.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#density vs sugar
ggplot(aes(x = residual.sugar, y = density), data = wine) +
  geom_point(alpha = 1/8, position = position_jitter(h = 0)) +
  xlim(0, quantile(wine$residual.sugar, 0.99)) +
  ylim(0.989, quantile(wine$density, 0.99)) +
  geom_smooth(method = 'lm', color = 'cyan1')
```

In this chart, we clearly see the positive linear relationship between density and sugar.
But why is density increasing with the amount of sugar?

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
#alcohol vs density
ggplot(aes(x = alcohol, y = density), data = wine) +
  geom_point(alpha = 1/8, position = position_jitter(h = 0)) +
  xlim(8, quantile(wine$alcohol, 0.99)) +
  ylim(0.989, quantile(wine$density, 0.99)) +
  geom_smooth(method = 'lm', color = 'cyan1')
```

In this graph, we see the clearly negative linear relationship between density and alcohol.
Why is density decreasing with higher alcohol levels?

### Multivariate Plots Section & Analysis

> **Time for Multivariate Stuff**#

Looking at density, sugar and alcohol at the same time might answer the questions from above.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ggplot(aes(x = residual.sugar, y = density, color = alcohol), data = wine) +
  geom_point(alpha = 1/2) +
  geom_smooth(method='lm', color = 'grey', linetype = 1) +
  xlim(0 , quantile(wine$residual.sugar,0.99)) +
  ylim(0.989, quantile(wine$density,0.99)) +
  ggtitle('Density vs Sugar vs Alcohol')
```

This visualization lets us observe 2 things: First, sweater wine has more density.
Second, wine with the same sweetness has larger volume of alcohol with lower density.
In other words, given a value of residual sugar, density increases as alcohol decreases. 

The reason for this is in some extent due to the fermentation process of winemaking, in which sugar is consumed to generate alcohol. Since alcohol is less dense than water and sugar is more dense than water, this process makes the density of the wine decrease.

But how does density and sugar affect quality?

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ggplot(aes(x= residual.sugar, y= density, color = category), 
       data = wine) +
  geom_smooth(method = 'loess', se = TRUE, size = 2) +
  geom_point(alpha = 1/6) +
  scale_color_brewer(type = 'seq', palette = 2,
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 2))) +
  xlim(quantile(wine$residual.sugar,0.01), quantile(wine$residual.sugar,0.99)) +
  scale_x_log10() +
  ylim(0.989, quantile(wine$density,0.99)) +
  ggtitle('Density vs Sugar vs Quality')
```

This chart shows how quality relates with density and residual sugar. The quality levels have been grouped to improve visibility (category).
We can observe, that for a given residual sugar concentration, quality increases as density increases. The same occurs if you fix density and increase residual sugar.

### Predictive Model

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
m1 <- lm(quality ~ alcohol, data = wine)
m2 <- update (m1, ~ . + density)
m3 <- update (m2, ~ . + chlorides)
m4 <- update (m3, ~ . + volatile.acidity)
m5 <- update (m4, ~ . + total.sulfur.dioxide)
m6 <- update (m5, ~ . + fixed.acidity)
m7 <- update (m6, ~ . + pH)
m8 <- update (m7, ~ . + residual.sugar)
m9 <- update (m8, ~ . + free.sulfur.dioxide)
m10 <- update (m9, ~ . + sulphates)
mtable(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, sdigits = 3)

```

The linear model above can be used for predicting the quality of wine given all substances/ ingredients. However, the R-squared value for the model is 0.282, which is a very low value and means that the model can only explain 28% of the variance of the data.

Further limitations: Since the dataset only contained wines in the 3 to 9 quality range, these models would be unreliable at identifying wines outside of this range. Second, the models are only valid for Portuguese "Vinho Verde" wines. A new model would likely be needed for each wine type.

------

### Final Plots and Summary

> **Favorites**

#### Plot One
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
# boxplot category
p20 <- ggplot(aes(x= category, y = density, fill = category), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(0.985, 1.005) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")
  
p21 <- ggplot(aes(x= category, y = alcohol, fill = category), data = wine) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = 'point', shape = 4) +
  ylim(8, quantile(wine$alcohol, 0.99)) +
  scale_fill_discrete(guide = guide_legend(reverse=TRUE)) +
  theme(legend.position="bottom") +
  scale_fill_brewer(palette="Blues")

grid.arrange(p20, p21, ncol = 2)
```

#### Description One
These boxplots visualize, the negative relationship between density and quality and the positive correlation between alcohol and quality.

#### Plot Two
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ggplot(aes(x = residual.sugar, y = density, color = alcohol), data = wine) +
  geom_point(alpha = 1/2) +
  geom_smooth(method='lm', color = 'grey', linetype = 1) +
  xlim(0 , quantile(wine$residual.sugar,0.99)) +
  ylim(0.989, quantile(wine$density,0.99)) +
  ggtitle('Density vs Sugar vs Alcohol')
```

#### Description Two

For a given value of residual sugar, density increases as alcohol decreases. 

This is due to the fermentation process of winemaking, in which sugar is consumed to generate alcohol. Since alcohol is less dense than water and sugar is more dense than water, this process makes the density of the wine decrease.

#### Plot Three
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ggplot(aes(x= residual.sugar, y= density, color = category), 
       data = wine) +
  geom_smooth(method = 'loess', se = TRUE, size = 2) +
  geom_point(alpha = 1/6) +
  scale_color_brewer(type = 'seq', palette = 2,
    guide = guide_legend(title = 'Quality', reverse = F,
    override.aes = list(alpha = 1, size = 2))) +
  xlim(quantile(wine$residual.sugar,0.01), quantile(wine$residual.sugar,0.99)) +
  scale_x_log10() +
  ylim(0.989, quantile(wine$density,0.99)) +
  ggtitle('Density vs Sugar vs Quality')
```

#### Description Three
For a given residual sugar concentration, quality increases as density increases. The same occurs if you fix density and increase residual sugar.

------

### Reflection

I structured my vino analysis as follows: at the very beginning I listed all variables with the respective description to better understand what I am dealing with. This is very important because it prepares to ask the right questions. I decdided to group the variables into 3 categories: Acidity, Sugar & Salts and Misc. I applied this structure throughout my analysis to make it easier to follow.
 
Kicking off the univariate analysis, I run some summary statistics to get a first glance at the data and its distribution.
Interestingly, none of the wines received the best or the worst quality score. All wines are ranked between 3 and 9. Additionally, in the dataset we have only a view wines with these extreme quality scores: for quality level 3 only 20 (0.4%) and for quality level 9 only 5 (0.1%). This is an important observation, since I knew at this point that maybe I would have to adjust the categories to get better insights into characteristics of different wine quality levels.
I continued with histograms to get a better feel for the data distribution. After cutting off the upper 1% quantile, adjusting the starting x-value and choosing a log-scale for some variables, all variables look reasonably normally distributed. For a view variables, there is some positive skewing.
After visualizing the quality categories the uneven distribution of wines per quality category becomes more tangible. 
 
Moving on to the bivariate stuff, I created boxplots that measure the 11 variables against the dependent variable quality trying to find factors influencing wine quality. Looking at acidity and sugar & salt variables against quality, there seems to be no clear/ sticking out relationships.
However, it seems that that with the increase of quality, density is decreasing. And for higher quality categories, the alcohol percentage seems to be rising as well. To dig deeper into that finding, I created new quality categories (high, medium, low) to get more data for each category. Visualizing density and alcohol percentage against the new quality categories even underlines the earlier findings and makes them even more visible.
Trying to find out more about the relationships between the data, I created a correlation coefficient matrix. I found a very strong positve linear relationship between density and sugar which I visualized with a graph. Further, we see a strong negative correlation between density and alcohol which I also displayed in a graph. There is also a moderatly positive relationship between alcohol and quality, which seems to add up with our observations from earlier.

In my multivariate section, I looked at the relationship between density, sugar and alcohol since I found out that there is a moderate to strong correlation going on between these variables. My first visualization shows that, wine with more sugar has more density. Moreover, holding the suguar amount constant, wines seem to have a larger volume of alcohol with lower density. In other words, given a value of residual sugar, density increases as alcohol decreases. This could be due to the fermentation process of winemaking, in which sugar is consumed to generate alcohol. Since alcohol is less dense than water and sugar is more dense than water, this process makes the density of the wine decrease.
But how does density and sugar affect quality? To answer that question I created a chart that shows how quality relates with density and residual sugar. The quality levels have been grouped to improve visibility (category). We observe, that for a given residual sugar concentration, quality increases as density increases. The same occurs if you fix density and increase residual sugar.

Finally, I run a linear regression to build a model for predicting wine quality. The model can be used for predicting the quality of wine given all substances/ ingredients. However, the R-squared value for the full model (m10) is 0.282, which is a relatively low value and means that the model can explain 28% of the variance of the data. The more variance that is accounted for by the regression model the closer the data points will fall to the fitted regression line. This is ok because the process of evaluating wines is very subjective, and experts can be biased by their histories and preferences, making the relation between quality and the other variables harder to predict.

However, every variable seems to have a statistically significant influence, since adding variables to the model (m1 to m10) increases the R-value from 0.190 to 0.282. This underlines that it might be interesting to look at the relationships of other variables in the future. For example, looking at total sulfur dioxide vs alcohol (correlation coefficient: -0.45) or density (0.53) or sugar (0.4) might be interesting. Additionally, analyzing chlorides vs quality (-0.36) might also be worth looking into. 

Having a bigger dataset with more wines from the extremes of the quality spectrum (i.e. many more quality 0-3 and quality 9-10 wines) might reveal more of the characteristics of quality vino. Further, it might be interesting to try the prediction model for different wine types. The model would probably have to be adjusted. One could create a new model for the other wine type and then compare the models.

The analysis process is a very valuable experience, since I practiced plotting various types of charts, handling overplotting and choosing the best chart type to convey the intended message. I experiemented a lot with the charts I used and it was fun to do so.

### References

https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf

http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram

https://stackoverflow.com/questions/43362420/length-of-dimnames-2-not-equal-to-array-extent-when-using-corrplot-function

http://www.sthda.com/english/articles/32-r-graphics-essentials/133-plot-one-variable-frequency-graph-density-distribution-and-more/

http://www.sthda.com/english/wiki/ggplot2-area-plot-quick-start-guide-r-software-and-data-visualization
https://ggplot2.tidyverse.org/reference/geom_smooth.html

https://stats.idre.ucla.edu/r/faq/how-can-i-explore-different-smooths-in-ggplot2/

https://stackoverflow.com/questions/11014804/plotting-multiple-smooth-lines-from-a-dataframe

http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/

http://www.sthda.com/english/wiki/ggplot2-box-plot-quick-start-guide-r-software-and-data-visualization

http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf
